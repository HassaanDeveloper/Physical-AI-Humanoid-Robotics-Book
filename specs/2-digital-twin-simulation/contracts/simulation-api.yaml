# API Contract: Digital Twin Simulation Interface

## Overview
This document defines the API contracts for the digital twin simulation system, enabling standardized interaction between different simulation components and educational tools.

## Base URL
```
http://localhost:8080/api/v1
```

## Authentication
All endpoints require authentication via Bearer token:
```
Authorization: Bearer {token}
```

## Common Headers
- `Content-Type: application/json`
- `Accept: application/json`

## Endpoints

### Simulation Management

#### GET /simulations
Retrieve a list of available simulations

**Response 200 (application/json)**
```json
{
  "simulations": [
    {
      "id": "sim_001",
      "name": "Humanoid Walking Simulation",
      "description": "Basic humanoid walking gait simulation",
      "type": "physics",
      "status": "ready",
      "created_at": "2026-01-10T10:00:00Z",
      "updated_at": "2026-01-10T10:00:00Z"
    }
  ],
  "pagination": {
    "page": 1,
    "per_page": 10,
    "total": 1
  }
}
```

#### POST /simulations
Create a new simulation instance

**Request Body**
```json
{
  "name": "Custom Simulation",
  "description": "A custom simulation for learning",
  "environment_id": "env_001",
  "robot_model_id": "robot_001",
  "configuration": {
    "gravity": 9.81,
    "friction_coefficient": 0.5,
    "timestep": 0.001
  }
}
```

**Response 201 (application/json)**
```json
{
  "id": "sim_123",
  "name": "Custom Simulation",
  "status": "initialized",
  "created_at": "2026-01-10T10:00:00Z",
  "instance_url": "http://localhost:8080/simulations/sim_123"
}
```

### Robot Control

#### GET /robots/{robot_id}/state
Get the current state of a robot

**Path Parameters**
- `robot_id`: ID of the robot

**Response 200 (application/json)**
```json
{
  "id": "robot_001",
  "position": {
    "x": 0.0,
    "y": 0.0,
    "z": 0.0
  },
  "orientation": {
    "qx": 0.0,
    "qy": 0.0,
    "qz": 0.0,
    "qw": 1.0
  },
  "joint_states": {
    "left_hip": 0.1,
    "right_hip": -0.1,
    "left_knee": 0.2,
    "right_knee": -0.2
  },
  "timestamp": "2026-01-10T10:00:00Z"
}
```

#### PUT /robots/{robot_id}/commands
Send commands to a robot

**Path Parameters**
- `robot_id`: ID of the robot

**Request Body**
```json
{
  "joint_commands": {
    "left_hip": 0.15,
    "right_hip": -0.15,
    "left_knee": 0.25,
    "right_knee": -0.25
  },
  "linear_velocity": {
    "x": 0.5,
    "y": 0.0,
    "z": 0.0
  },
  "angular_velocity": {
    "x": 0.0,
    "y": 0.0,
    "z": 0.1
  }
}
```

**Response 200 (application/json)**
```json
{
  "success": true,
  "command_id": "cmd_456",
  "timestamp": "2026-01-10T10:00:00Z"
}
```

### Sensor Data

#### GET /sensors/{sensor_id}/data
Get sensor data from a specific sensor

**Path Parameters**
- `sensor_id`: ID of the sensor

**Query Parameters**
- `limit`: Number of data points to return (default: 10)
- `since`: Timestamp to get data from (ISO 8601 format)

**Response 200 (application/json)**
```json
{
  "sensor_id": "lidar_001",
  "sensor_type": "LiDAR",
  "data_points": [
    {
      "timestamp": "2026-01-10T10:00:00Z",
      "data": {
        "ranges": [1.2, 1.3, 1.4, "..."],
        "intensities": [100, 95, 90, "..."],
        "frame_id": "lidar_link"
      }
    }
  ]
}
```

### Learning Path Progress

#### GET /students/{student_id}/progress
Get a student's progress through a learning path

**Path Parameters**
- `student_id`: ID of the student

**Response 200 (application/json)**
```json
{
  "student_id": "student_001",
  "learning_path_id": "path_001",
  "modules_completed": 2,
  "total_modules": 4,
  "completion_percentage": 50.0,
  "current_module": "physics-simulation-with-gazebo",
  "last_accessed": "2026-01-10T09:30:00Z",
  "time_spent_minutes": 120
}
```

#### PUT /students/{student_id}/progress/{module_id}
Update student progress for a specific module

**Path Parameters**
- `student_id`: ID of the student
- `module_id`: ID of the module

**Request Body**
```json
{
  "completed": true,
  "score": 85,
  "feedback": "Successfully completed the physics simulation exercise",
  "time_taken_seconds": 1800
}
```

**Response 200 (application/json)**
```json
{
  "success": true,
  "updated_at": "2026-01-10T10:00:00Z",
  "next_module": "unity-environment-interaction"
}
```

## Error Responses

All error responses follow this structure:

**Response 4xx/5xx (application/json)**
```json
{
  "error": {
    "code": "INVALID_INPUT",
    "message": "The request contains invalid input parameters",
    "details": {
      "field": "gravity",
      "issue": "Value must be between 0 and 20"
    }
  }
}
```

## Common Error Codes
- `INVALID_INPUT`: Request contains invalid parameters
- `RESOURCE_NOT_FOUND`: Requested resource does not exist
- `UNAUTHORIZED`: Authentication required or failed
- `SIMULATION_ERROR`: Error occurred during simulation
- `INSUFFICIENT_RESOURCES`: System lacks resources to fulfill request